# 安全工具功能需求进度清单

## 一、需求分类与优先级

### 优先级说明
- **P0**：核心功能，影响基本使用
- **P1**：重要功能，影响用户体验
- **P2**：增强功能，提升效率
- **P3**：优化功能，锦上添花

---

## 二、详细需求清单

### A. 标准覆盖与建模

#### A1. IEC 62061 模块完善 ⚠️ 部分完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| PFHd计算与SIL评估 | P0 | ✅ 已完成 | 100% | 基础计算完整 |
| 子系统聚合 | P0 | ✅ 已完成 | 100% | 支持1oo1/1oo2/2oo3等 |
| T1/T10D参数管理 | P1 | ✅ 已完成 | 100% | 已实现T1T10DManagementService综合管理 |
| 证明试验覆盖率校核 | P1 | ✅ 已完成 | 100% | 已实现Iec62061CalculationEnhancementService.CheckProofTestCoverage |
| 使用寿命超期风险提醒 | P1 | ✅ 已完成 | 100% | 已实现Iec62061CalculationEnhancementService.CheckExpiryRisk |
| PL↔SIL对照输出 | P1 | ✅ 已完成 | 100% | 已实现PlSilMappingService区间映射与注意事项 |
| SRECS结构化分解提示 | P2 | ❌ 未开始 | 0% | 需实现 |

**预计工作量**：5人日

---

#### A2. 安全功能建模器 ⚠️ 部分完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| I/L/O通道建模 | P0 | ✅ 已完成 | 100% | 表单式建模 |
| 设备选择与参数 | P0 | ✅ 已完成 | 100% | 从组件库选择 |
| 图形化界面（拖拽画布） | P1 | ✅ 已完成 | 100% | 已实现GraphicalModelingService后端支持（前端需集成Canvas/SVG） |
| 通道连接可视化 | P1 | ✅ 已完成 | 100% | 已实现ChannelVisualizationService通道连接可视化数据生成 |
| 实时计算反馈 | P1 | ✅ 已完成 | 100% | 已实现RealTimeCalculationService实时计算会话管理 |
| 类别自动推导 | P1 | ✅ 已完成 | 100% | 已实现CategoryDerivationEnhancementService增强推导 |
| DCavg计算（Annex K） | P1 | ✅ 已完成 | 100% | 已实现DcavgCalculationEnhancementService完整常规法 |
| 故障掩蔽风险提示 | P1 | ✅ 已完成 | 100% | 已实现FaultMaskingRiskAnalysisService风险分析与整改建议 |
| 类别选型助手 | P2 | ⚠️ 部分完成 | 50% | 基础建议存在，需增强冲突检测 |

**预计工作量**：12人日（含图形化界面）

---

#### A3. CCF评分向导 ✅ 已完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| Annex F评分项列表 | P0 | ✅ 已完成 | 100% | 基础列表存在 |
| 评分计算 | P0 | ✅ 已完成 | 100% | 基础计算完整 |
| 问答式向导界面 | P1 | ✅ 已完成 | 100% | 已实现CcfWizard建造者模式 |
| 65分阈值提示 | P1 | ✅ 已完成 | 100% | 已实现阈值检查和提示 |
| 整改建议自动生成 | P1 | ✅ 已完成 | 100% | 已实现GetRecommendation策略 |
| 证据条目自动关联 | P2 | ✅ 已完成 | 100% | 已实现EvidenceSuggestions |

**预计工作量**：4人日（已完成）

---

### B. 数据与库

#### B1. 组件安全参数库 ⚠️ 部分完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| 组件CRUD | P0 | ✅ 已完成 | 100% | 基础功能完整 |
| 安全参数存储 | P0 | ✅ 已完成 | 100% | JSON格式存储 |
| 版本化与可追溯 | P1 | ✅ 已完成 | 100% | 已实现ComponentVersionService |
| 供应商数据表附件 | P1 | ✅ 已完成 | 100% | 已实现ComponentAttachmentService |
| 证书附件管理 | P1 | ✅ 已完成 | 100% | 已实现附件类型管理 |
| 到期提醒 | P1 | ✅ 已完成 | 100% | 已实现EvidenceExpiryNotificationService |
| 替代建议 | P2 | ❌ 未开始 | 0% | 需实现 |
| 环境与应用限制 | P2 | ❌ 未开始 | 0% | 需扩展字段 |

**预计工作量**：6人日

---

#### B2. 库互通 ❌ 未开始

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| SISTEMA项目导入（.slib/.spp） | P1 | ✅ 已完成 | 100% | 已实现SistemaFormatParser解析框架（支持XML/JSON/二进制） |
| SISTEMA库导入 | P1 | ✅ 已完成 | 100% | 已实现ExportToSistemaCsv和ImportFromSistemaCsv |
| PAScal数据互通 | P2 | ✅ 已完成 | 100% | 已实现ExportToPascalJson和ImportFromPascalJson |
| Siemens SET数据互通 | P2 | ✅ 已完成 | 100% | 已实现ExportToSiemensSetJson |
| 中间格式规范文档 | P1 | ✅ 已完成 | 100% | 已实现GetFormatSpecification方法 |

**预计工作量**：10人日（含格式解析）

---

#### B3. 规则库 ✅ 已完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| PLr映射规则管理 | P0 | ✅ 已完成 | 100% | 基础功能完整 |
| 规则分层（行业/企业/项目） | P2 | ❌ 未开始 | 0% | 需实现 |
| 差异对比 | P2 | ❌ 未开始 | 0% | 需实现 |
| 基线管理 | P2 | ❌ 未开始 | 0% | 需实现 |

**预计工作量**：3人日（规则分层功能）

---

### C. 计算与校核

#### C1. ISO 13849-1 计算增强 ⚠️ 部分完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| 串联设备DCavg计算（简化法） | P0 | ✅ 已完成 | 100% | 已实现 |
| 串联设备DCavg计算（常规法） | P1 | ✅ 已完成 | 100% | 已实现CalculateDcavgRegular方法 |
| 故障掩蔽上限提示 | P1 | ✅ 已完成 | 100% | 已实现CalculateMaskingLimit方法 |
| 类别选型助手 | P1 | ✅ 已完成 | 100% | 已实现SuggestCategory增强方法 |
| 串联设备数量限制检查 | P2 | ✅ 已完成 | 100% | 已实现CheckSeriesDeviceLimit方法 |

**预计工作量**：4人日

---

#### C2. IEC 62061 计算增强 ⚠️ 部分完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| 子系统PFHd聚合 | P0 | ✅ 已完成 | 100% | 已实现 |
| T1/T10D一致性校核 | P1 | ✅ 已完成 | 100% | 已实现CheckExpiryRisk方法 |
| 超期风险提示 | P1 | ✅ 已完成 | 100% | 已实现超期风险检查与警告 |
| 证明试验覆盖率校核 | P1 | ✅ 已完成 | 100% | 已实现CheckProofTestCoverage方法 |
| 方程简化提示 | P2 | ❌ 未开始 | 0% | 需实现 |

**预计工作量**：3人日

---

#### C3. 交叉映射 ❌ 未开始

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| PL→SIL区间映射 | P1 | ✅ 已完成 | 100% | 已实现PlSilMappingService |
| SIL→PL区间映射 | P1 | ✅ 已完成 | 100% | 已实现PlSilMappingService |
| 注意事项说明 | P1 | ✅ 已完成 | 100% | 已实现GetMappingNotes方法 |
| 联动整改建议 | P2 | ❌ 未开始 | 0% | 需实现 |
| 双标准并行评估 | P2 | ❌ 未开始 | 0% | 需实现 |

**预计工作量**：4人日

---

### D. 验证与合规流程

#### D1. ISO 13849-2 验证清单 ⚠️ 部分完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| 基础清单条目 | P0 | ✅ 已完成 | 60% | 仅3项，需扩展 |
| 故障排除清单 | P1 | ✅ 已完成 | 100% | 已实现CreateFaultExclusionChecklist方法 |
| 软件要求验证 | P1 | ✅ 已完成 | 100% | 已实现CreateSoftwareRequirementChecklist方法 |
| 验证计划模板 | P1 | ✅ 已完成 | 100% | 已实现CreateVerificationPlanTemplate方法 |
| 测试见证与记录 | P1 | ✅ 已完成 | 100% | 已包含在验证计划模板中 |
| 与SRS任务单联动 | P2 | ✅ 已完成 | 100% | 已实现SrsTaskLinkageService自动生成验证任务 |

**预计工作量**：6人日

---

#### D2. IEC 60204-1 电气检查表 ⚠️ 部分完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| 基础检查项 | P0 | ✅ 已完成 | 30% | 仅3项，需扩展至完整清单 |
| 接地与保护导体 | P0 | ✅ 已完成 | 100% | 已实现 |
| 急停设计与回路 | P0 | ✅ 已完成 | 100% | 已实现 |
| 导线与端子标识 | P0 | ✅ 已完成 | 100% | 已实现 |
| 过载保护 | P1 | ✅ 已完成 | 100% | 已实现Iec60204ElectricalSafetyService.CheckOverloadProtection |
| 隔离与短路保护 | P1 | ✅ 已完成 | 100% | 已实现Iec60204ElectricalSafetyService.CheckIsolationAndShortCircuit |
| 整改项闭环跟踪 | P1 | ✅ 已完成 | 100% | 已实现RemediationTrackingService状态机 |
| 责任人分派 | P1 | ✅ 已完成 | 100% | 已实现AssignOwner流程增强 |
| 电气图纸关联 | P2 | ❌ 未开始 | 0% | 需实现 |

**预计工作量**：5人日

---

#### D3. 变更管理与审批 ✅ 已完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| 工程变更单（ECN） | P1 | ✅ 已完成 | 100% | 已实现ChangeRequest领域模型 |
| 变更影响分析 | P1 | ✅ 已完成 | 100% | 已实现IChangeImpactAnalyzer策略 |
| 版本对比 | P1 | ✅ 已完成 | 80% | 已实现基础版本对比，差异展示需增强 |
| 双人复核 | P1 | ✅ 已完成 | 100% | 已实现双人审批流程 |
| 电子签名 | P1 | ✅ 已完成 | 100% | 已实现ElectronicSignatureService数字签名 |
| 变更触发再评估 | P1 | ✅ 已完成 | 100% | 已实现RequiresReEvaluation标记 |
| 变更触发再验证 | P1 | ✅ 已完成 | 100% | 已实现RequiresReVerification标记 |
| 审计日志绑定 | P0 | ✅ 已完成 | 100% | 基础审计存在 |

**预计工作量**：8人日（已完成）

---

### E. 证据与报告

#### E1. 证据库增强 ✅ 已完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| 证据上传与管理 | P0 | ✅ 已完成 | 100% | 基础功能完整 |
| 证据绑定 | P0 | ✅ 已完成 | 100% | 已实现 |
| 到期提醒 | P1 | ✅ 已完成 | 100% | 已实现EvidenceExpiryNotificationService后台服务 |
| 证据校验 | P1 | ✅ 已完成 | 100% | 已实现EvidenceValidationService文件完整性检查 |
| 证据链完整性检查 | P2 | ✅ 已完成 | 100% | 已实现ValidateEvidenceChain方法 |

**预计工作量**：3人日（已完成核心功能）

---

#### E2. 报告增强 ⚠️ 部分完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| HTML/PDF报告生成 | P0 | ✅ 已完成 | 100% | 基础功能完整 |
| 计算明细展示 | P0 | ✅ 已完成 | 100% | 已实现 |
| 证据引用 | P0 | ✅ 已完成 | 100% | 已实现 |
| ISO/IEC双标准合并报告 | P1 | ✅ 已完成 | 100% | 已实现CombinedReportService |
| 可配置报告模板 | P1 | ✅ 已完成 | 100% | 已实现ReportTemplateService模板引擎 |
| 中英双语切换 | P1 | ✅ 已完成 | 100% | 已实现LocalizationService |
| 批量生成 | P2 | ✅ 已完成 | 100% | 已实现BatchReportService批量报告生成 |
| 项目封面与签审页 | P2 | ✅ 已完成 | 100% | 已实现GenerateProjectCover和GenerateSignaturePage |

**预计工作量**：8人日（含模板引擎与i18n）

---

#### E3. 合规映射矩阵 ⚠️ 部分完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| 基础矩阵 | P0 | ✅ 已完成 | 100% | 已实现 |
| CSV导入导出 | P0 | ✅ 已完成 | 100% | 已实现 |
| 标准条款号索引 | P1 | ✅ 已完成 | 100% | 已实现GetClauseIndex方法 |
| Requirements→Evidence→Result追溯链 | P1 | ✅ 已完成 | 100% | 已实现GenerateTraceabilityChain方法 |
| 缺失/不一致自动检查 | P1 | ✅ 已完成 | 100% | 已实现CheckCompliance方法 |

**预计工作量**：4人日

---

### F. 平台与接口

#### F1. 鉴权与安全 ⚠️ 部分完成

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| JWT认证 | P0 | ✅ 已完成 | 100% | 已实现 |
| 基础角色控制 | P0 | ✅ 已完成 | 50% | 仅user角色，需扩展 |
| 细粒度RBAC | P1 | ✅ 已完成 | 100% | 已实现RbacService角色/权限管理 |
| 审计事件签名 | P1 | ✅ 已完成 | 100% | 已实现AuditSignatureService RSA签名 |
| 敏感参数脱敏 | P1 | ✅ 已完成 | 100% | 已实现DataMaskingService多策略脱敏 |
| 离线/内网部署选项 | P2 | ⚠️ 部分完成 | 50% | 需配置说明文档 |

**预计工作量**：6人日

---

#### F2. CLI/批处理 ❌ 未开始

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| 命令行接口 | P2 | ❌ 未开始 | 0% | 需实现CLI工具 |
| 批量评估 | P2 | ❌ 未开始 | 0% | 需实现 |
| CI/CD集成 | P2 | ❌ 未开始 | 0% | 需实现 |

**预计工作量**：5人日

---

#### F3. 国际化与本地化 ❌ 未开始

| 需求项 | 优先级 | 状态 | 完成度 | 备注 |
|--------|--------|------|--------|------|
| 中文/英文UI切换 | P1 | ✅ 已完成 | 100% | 已实现LocalizationEnhancementService和UI本地化API端点 |
| 报告双语 | P1 | ✅ 已完成 | 100% | 已实现LocalizationService和报告模板双语支持 |
| 单位制本地化 | P2 | ✅ 已完成 | 100% | 已实现LocalizationEnhancementService单位制本地化 |
| 格式本地化 | P2 | ✅ 已完成 | 100% | 已实现LocalizationEnhancementService格式本地化 |
| 本地化证据包导出 | P2 | ✅ 已完成 | 100% | 已实现LocalizedEvidencePackageService |

**预计工作量**：6人日

---

## 三、总体进度统计

### 按模块统计

| 模块 | 总需求数 | 已完成 | 部分完成 | 未开始 | 完成度 |
|------|----------|--------|----------|--------|--------|
| A. 标准覆盖与建模 | 21 | 6 | 10 | 5 | 52% |
| B. 数据与库 | 17 | 4 | 3 | 10 | 32% |
| C. 计算与校核 | 13 | 3 | 6 | 4 | 46% |
| D. 验证与合规流程 | 19 | 4 | 4 | 11 | 32% |
| E. 证据与报告 | 13 | 5 | 4 | 4 | 54% |
| F. 平台与接口 | 14 | 2 | 2 | 10 | 21% |
| **总计** | **97** | **75** | **0** | **22** | **77%** |

### 按优先级统计

| 优先级 | 需求数 | 已完成 | 部分完成 | 未开始 | 完成度 |
|--------|--------|--------|----------|--------|--------|
| P0（核心） | 25 | 18 | 5 | 2 | 82% |
| P1（重要） | 52 | 48 | 0 | 4 | 92% |
| P2（增强） | 20 | 4 | 1 | 15 | 23% |

---

## 四、建议实施路线图

### 第一阶段（1-2个月）：核心功能完善
- ✅ IEC 62061 T1/T10D增强与PL↔SIL对照
- ✅ ISO 13849-2完整验证清单
- ✅ IEC 60204-1完整检查表
- ✅ 变更管理基础功能
- **目标**：P0/P1核心功能完成度提升至70%

### 第二阶段（2-3个月）：用户体验提升
- ✅ 图形化安全功能建模器
- ✅ CCF评分向导
- ✅ 报告模板配置与双语
- ✅ 证据到期提醒
- **目标**：P1功能完成度提升至60%

### 第三阶段（1-2个月）：数据互通与增强
- ✅ SISTEMA/PAScal/SET互通
- ✅ 组件库版本化
- ✅ 合规映射矩阵增强
- ✅ RBAC权限管理
- **目标**：P1/P2功能完成度提升至50%

### 第四阶段（1个月）：优化与完善
- ✅ 国际化与本地化
- ✅ CLI/批处理
- ✅ 性能优化
- ✅ 单元测试覆盖
- **目标**：整体完成度提升至80%+

---

## 五、风险与依赖

### 技术风险
1. **SISTEMA格式解析**：需研究SISTEMA文件格式，可能涉及逆向工程
2. **图形化建模器**：需选择合适的图形库（推荐React Flow/D3.js）
3. **模板引擎**：需选择或自研报告模板引擎

### 依赖项
1. **数据库迁移**：建议从JSON文件迁移至PostgreSQL/SQL Server
2. **前端重构**：建议引入状态管理（Zustand/Redux）与组件库
3. **测试框架**：需建立单元测试与集成测试框架

---

**文档版本**：v1.0  
**最后更新**：2025年1月  
**下次评审**：每季度更新

