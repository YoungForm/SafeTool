## 目标与范围
- 将现有“ISO 12100 + ISO 13849-1”合规自检工具扩展为覆盖主流机械功能安全标准、完整建模计算、合规证据与审计闭环的工程化平台。
- 面向工程师、评估与认证团队，支持从风险评估→安全功能设计→计算验证→报告→审批与审计→证据归档的端到端流程。

## 现状回顾（代码与功能）
- 后端：.NET 9 Minimal API，JWT 认证，审计留痕；核心服务已具备 ISO12100 风险评估、ISO13849 计算、CCF/PLr 映射、HTML/PDF 报告、SRS 创建/审批/导出、AI 文本增强。
- 前端：React+TS 单页应用，提供评估、SRS、CCF助手、规则配置与审计查询界面。
- 存在缺口：IEC 62061（SIL/PFHd）计算、组件参数库与外部工具互通（SISTEMA/PAScal/SET）、ISO 13849-2 验证流程、IEC 60204-1 电气安全检查、结构化安全功能建模、跨标准对照与证据管理。

## 标准对齐（核心依据）
- ISO 12100：危险识别、风险估计与风险降低的总框架。
- ISO 13849-1/-2：SRP/CS 设计与验证，PL 计算要素 Category、MTTFd、DCavg、CCF（参考：ISO 13849 概述与 PL 要素[Wikipedia，ISO 13849] https://en.wikipedia.org/wiki/ISO_13849；KEYENCE PL 参数知识页 https://www.keyence.com/ss/products/safetyknowledge/performance/parameter/）。
- IEC 62061：机械安全电/电子/可编程控制系统功能安全，SIL 与 PFHd 计算、证明试验间隔与寿命（参考：Siemens Safety Evaluation Tool 说明 https://www.siemens.com/us/en/products/automation/topic-areas/safety-integrated/factory-automation/support/safety-evaluation-tool.html；Rockwell 白皮书PFHd/mission time https://literature.rockwellautomation.com/idc/groups/literature/documents/wp/safety-wp040_-en-p.pdf）。
- IEC 60204-1：机械电气设备安全的电气设计与检查要点。
- 交叉对照：PL↔SIL 对照与参数对应（MTTFd 与 PFHd 的关系说明示例 https://www.sho-cert.com/content/?1309.html=）。

## 竞品/行业工具调研要点
- IFA SISTEMA：ISO 13849-1 SRP/CS 评估软件，支持 MTTFd、DCavg、CCF、类别、PLr，提供库管理与报告（示例解读与特性说明 https://product-development-engineers.com/2025/04/02/sistema-and-en-iso-13849-1-explained/；官方资料 https://www.dguv.de/medien/ifa/en/pra/softwa/sistema/paper_e.pdf；版本特性概述 https://www.cem4.eu/en/news/81-sistema-en-iso-13849-1-v-1-1-6）。
- Pilz PAScal：支持 ISO 13849-1 与混合子系统建模、计算与报告（发行说明示例 https://downloads.pilz.nl/downloads/PAScal/Readme_PAScal_1_9_0_en.pdf）。
- Siemens SET：TÜV 评测支持，覆盖 IEC 62061 与 ISO 13849-1，在线快速评估与报告（https://www.siemens.com/us/en/products/automation/topic-areas/safety-integrated/factory-automation/support/safety-evaluation-tool.html）。
- 行业服务与认证：SGS/VIA 等提供 PL/SIL 计算、差距分析与认证辅导，强调 PFH/PFD、开发过程与证据（https://www.sgsonline.com.cn/sku/product/901484）。

## 功能需求改进（分模块）
### A. 标准覆盖与建模
- 新增 IEC 62061 模块：支持 PFHd 计算、SIL 目标/达成评估、Proof Test Interval/T1、Mission Time/T10D 参数管理与校核；提供 PL↔SIL 对照输出。
- 安全功能建模器：按 I/L/O 通道与类别结构（B/1/2/3/4）图形化建模；自动推导 Category、串联设备 DCavg 简化法与正则法（Annex K）提示与计算。
- CCF 评分向导：基于 Annex F 65 分阈值的问答式评分，生成证据条目与整改建议。

### B. 数据与库
- 组件参数库：维护设备 B10d、MTTFd、DC 能力、PFHd 等安全参数；支持供应商数据表与证书附件；版本化与可追溯。
- 库互通：
  - 导入/导出 SISTEMA 项目与库（.slib/.spp 或CSV映射）。
  - PAScal/SET 数据互通（以中间CSV/JSON桥接）。
- 规则库：PLr 映射与可编辑策略分层（行业/企业/项目），差异对比与基线管理。

### C. 计算与校核
- ISO 13849-1 计算增强：
  - 串联设备故障掩蔽与 DCavg 上限提示（Annex K 简化与常规法路径）。
  - 类别选型助手（依据设备冗余、监测与测试设计特征自动建议）。
- IEC 62061 计算增强：
  - 子系统 PFHd 聚合、SRECS 结构化分解与方程简化提示。
  - 使用寿命/证明试验间隔一致性校核与超期风险提示。
- 交叉映射：PL→SIL 与 SIL→PL 的区间映射与注意事项说明，联动整改建议。

### D. 验证与合规流程
- ISO 13849-2 验证清单：故障排除、软件要求、验证计划、测试见证与记录模板；与 SRS 任务单联动。
- IEC 60204-1 电气检查表：接地、急停、导线标识、过载保护、隔离与短路保护等；形成整改项与责任人分派。
- 变更管理与审批：工程变更单、影响分析、版本对比、双人复核与电子签名；与审计日志强绑定。

### E. 证据与报告
- 证据库：附件（数据表、证书、试验报告、照片/视频）、来源与校验、到期提醒；与安全功能、计算与验证记录关联。
- 报告增强：
  - ISO/IEC 双标准合并报告，含计算明细、假设、边界条件与不确定性说明。
  - 可配置报告模板（中/英双语），导出 HTML/PDF；批量生成与项目封面。
- 合规映射：各条款与证据、计算、测试的可追溯矩阵（Requirements→Evidence→Result）。

### F. 平台与接口
- 鉴权与安全：细粒度 RBAC、审计事件签名与防篡改、敏感参数脱敏；离线/内网部署选项。
- CLI/批处理：提供命令行接口用于批量评估与报告生成；与 CI/CD 集成。
- 国际化与本地化：中文/英文切换，单位制与格式本地化；可导出本地化证据包。

## 非功能需求
- 可用性：模型向导与规则提示，输入校验与错误自解释。
- 性能与扩展：组件库万级规模、项目百级并发评估；缓存与后台任务。
- 可靠性：数据版本化与快照；审计日志不可变存储；备份与恢复策略。
- 安全性：秘钥管理、最小权限、文件型证据扫描与病毒防护提示。

## 验证与合规映射
- 为每项功能绑定标准条款号与验证用例：
  - ISO 13849-1 表/附录项、Annex F/K 的对应计算与检查。
  - IEC 62061 PFHd/子系统/试验间隔校核的单元测试与集成测试。
  - ISO 13849-2/IEC 60204-1 的流程性清单驱动验收。
- 引入示例项目与回归场景，覆盖 PLc→PLd→PLe 与 SIL1→SIL3 的典型组合。

## 交付物
- 需求规格：用例、数据模型、计算公式与边界条件说明，标准条款映射。
- 原型与设计：前端模型器、库管理、计算结果页与报告模板草图。
- 测试方案：单元/集成/端到端测试清单与示例数据集（含 PL↔SIL 映射场景）。
- 互通规范：SISTEMA/PAScal/SET 的导入导出中间格式说明与适配计划。

## 备注与引用
- SISTEMA 与 ISO 13849-1 评估示例与参数要素（MTTFd/DCavg/CCF/类别/PLr）：https://product-development-engineers.com/2025/04/02/sistema-and-en-iso-13849-1-explained/ 、https://www.dguv.de/medien/ifa/en/pra/softwa/sistema/paper_e.pdf
- PAScal 功能点与混合子系统：https://downloads.pilz.nl/downloads/PAScal/Readme_PAScal_1_9_0_en.pdf
- Siemens SET 覆盖 IEC 62061 与 ISO 13849-1：
  https://www.siemens.com/us/en/products/automation/topic-areas/safety-integrated/factory-automation/support/safety-evaluation-tool.html
- PL 参数与 PL↔SIL 概念说明：
  https://www.keyence.com/ss/products/safetyknowledge/performance/parameter/ 、https://en.wikipedia.org/wiki/ISO_13849 、https://www.sho-cert.com/content/?1309.html=
- PFHd/寿命与证明试验间隔的工程考量：
  https://literature.rockwellautomation.com/idc/groups/literature/documents/wp/safety-wp040_-en-p.pdf

——请确认以上功能需求方向；确认后我将分阶段细化数据模型、接口与前后端原型，并提交首批实现方案与验证用例。