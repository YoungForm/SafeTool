# 安全工具功能需求完善（基于标准与竞品调研）

## 1. 目标与范围
- 扩展现有 ISO 12100 + ISO 13849-1 合规自检平台，覆盖 IEC 62061、ISO 13849-2 验证流程、IEC 60204-1 电气安全检查，形成从风险评估→安全功能建模→计算验证→报告→审批与审计→证据归档的闭环。
- 面向机械安全工程师、认证团队与质量合规负责人，支持单机与产线级项目，支持中/英双语与离线部署。

## 2. 现状概述
- 已有能力：ISO12100 风险评估、ISO13849 PL 计算、PLr 映射、CCF 评分、HTML/PDF 报告、SRS 创建/审批/追溯、审计日志、JWT 鉴权、AI 文本增强。
- 缺口：IEC62061（SIL/PFHd）计算与对照、组件安全参数库与外部工具互通（SISTEMA/PAScal/SET）、ISO13849-2 验证流程、IEC60204-1 电气检查、图形化安全功能建模、证据库与条款映射报告。

## 3. 标准对齐
- ISO 12100：危险识别/风险估计/风险降低总框架。
- ISO 13849-1/-2：SRP/CS 设计与验证；PL 计算要素 Category/MTTFd/DCavg/CCF；验证与故障排除流程。
- IEC 62061：SRECS 功能安全，SIL 与 PFHd 计算、证明试验间隔（T1）与使命时间（T10D）。
- IEC 60204-1：机械电气设备安全检查项（接地、急停、导线标识、过载/短路保护等）。
- 交叉对照：PL↔SIL 映射与参数对应（MTTFd 与 PFHd）。

## 4. 功能需求（分模块）
### A. 标准覆盖与建模
1) IEC 62061 模块：
   - PFHd 计算、SIL 目标/达成评估；支持子系统聚合与 SRECS 分解。
   - 证明试验间隔 T1 与使命时间 T10D 的参数管理与一致性校核。
   - PL↔SIL 对照输出，明确边界条件与注意事项。
2) 安全功能建模器：
   - 以 I/L/O 通道建模安全功能；通道冗余、监测/测试特征录入。
   - 自动推导 Category（B/1/2/3/4）与 DCavg（串联设备简化法/常规法），提示故障掩蔽风险。
3) CCF 评分向导：
   - Annex F 问答式打分，目标≥65；生成整改建议与证据条目。

### B. 数据与库
1) 组件安全参数库：
   - 设备型号维度的 B10d、MTTFd、DC 能力、PFHd、环境与应用限制；供应商证书与数据表附件。
   - 版本化与可追溯；到期提醒与替代建议。
2) 库互通：
   - 导入/导出 SISTEMA 项目与库（.slib/.spp/CSV等，采用中间 JSON/CSV 映射）。
   - PAScal/SET 数据互通，保留关键参数与结构信息。
3) 规则库：
   - PLr 映射策略分层（行业/企业/项目）；差异化对比与基线管理。

### C. 计算与校核
1) ISO 13849-1 增强：
   - 串联设备故障掩蔽与 DCavg 上限提示（Annex K 简化/常规法）。
   - 类别选型助手：基于冗余与监测策略的自动建议与冲突检测。
2) IEC 62061 增强：
   - 子系统 PFHd 聚合、方程简化提示；T1/T10D 超期风险提示。
3) 交叉映射：
   - PL→SIL 与 SIL→PL 的区间映射与注意事项，联动整改建议。

### D. 验证与合规流程
1) ISO 13849-2 验证清单：
   - 软件要求、验证计划、测试用例、见证与记录模板；与 SRS 任务联动。
2) IEC 60204-1 电气检查表：
   - 形成整改项、责任人分派、闭环跟踪与审计。
3) 变更管理与审批：
   - 工程变更单、影响分析、版本对比、双人复核与电子签名；审计日志防篡改。

### E. 证据与报告
1) 证据库：
   - 附件（证书、数据表、试验报告、照片/视频）、来源与校验、到期提醒；与安全功能/计算/验证记录关联。
2) 报告模板：
   - ISO/IEC 合并报告，含计算明细、假设、边界条件与不确定性说明；中/英双语；批量生成。
3) 合规映射矩阵：
   - 条款→证据→结果的追溯矩阵，支持导出与审计。

### F. 平台与接口
1) 鉴权与安全：
   - RBAC、审计事件签名与防篡改、敏感参数脱敏；离线/内网部署。
2) CLI/批处理与 CI：
   - 批量评估与报告生成；与 CI/CD 集成用于自动化合规检查。
3) 国际化与本地化：
   - 中文/英文切换，单位制与格式本地化；可导出本地化证据包。

## 5. 非功能需求
- 可用性：模型向导与规则提示，输入校验与错误自解释。
- 性能：组件库万级规模、项目百级并发评估；缓存与后台任务。
- 可靠性：数据版本化与快照；审计日志不可变存储；备份与恢复。
- 安全性：秘钥管理、最小权限、文件型证据扫描与病毒防护提示。

## 6. 验证策略与合规映射
- 为每项功能绑定条款与测试：
  - ISO 13849-1 表/附录项、Annex F/K 的计算与检查用例。
  - IEC 62061 PFHd/子系统/试验间隔校核的单元与集成测试。
  - ISO 13849-2/IEC 60204-1 的流程清单驱动验收。
- 示例项目：覆盖 PLc→PLd→PLe 与 SIL1→SIL3 的典型组合与边界案例。

## 7. 互通规范（概要）
- 中间格式：定义 JSON/CSV 字段集合，覆盖组件参数（B10d/MTTFd/DC/PFHd）、结构（I/L/O、类别）、函数分组、计算选项。
- 映射策略：
  - SISTEMA：库条目映射到组件模型；项目结构映射到功能建模器结构。
  - PAScal/SET：以子系统/参数为核心的字段映射；保留计算边界条件与假设。

## 8. 交付物
- 需求规格：用例、数据模型、计算公式与边界条件说明、条款映射清单。
- 原型与设计：前端模型器/库管理/计算结果页与报告模板草图。
- 测试方案：单元/集成/端到端测试清单与示例数据集（含 PL↔SIL 场景）。
- 互通规范：SISTEMA/PAScal/SET 导入导出中间格式文档与适配计划。

## 9. 参考资料
- SISTEMA 与 ISO 13849-1 评估（MTTFd/DCavg/CCF/类别/PLr）：
  - https://product-development-engineers.com/2025/04/02/sistema-and-en-iso-13849-1-explained/
  - https://www.dguv.de/medien/ifa/en/pra/softwa/sistema/paper_e.pdf
- PAScal 功能点与混合子系统：
  - https://downloads.pilz.nl/downloads/PAScal/Readme_PAScal_1_9_0_en.pdf
- Siemens SET 覆盖 IEC 62061 与 ISO 13849-1：
  - https://www.siemens.com/us/en/products/automation/topic-areas/safety-integrated/factory-automation/support/safety-evaluation-tool.html
- PL 参数与 PL↔SIL 概念说明：
  - https://www.keyence.com/ss/products/safetyknowledge/performance/parameter/
  - https://en.wikipedia.org/wiki/ISO_13849
  - https://www.sho-cert.com/content/?1309.html=
- PFHd/寿命与证明试验间隔：
  - https://literature.rockwellautomation.com/idc/groups/literature/documents/wp/safety-wp040_-en-p.pdf

