# 设计目标与范围
## 目标
- 面向机械/安全控制系统的用户认证与自检，软件化落地 ISO 12100 与 ISO 13849-1 合规评估。
- 新增 SRS（安全需求规格，Safety Requirements Specification）功能，用于系统化描述 SRP/CS 的安全需求并与评估/验证双向追溯。

# 可添加的软件功能清单
## ISO 12100 相关
- 危害库与风险识别向导、S/F/A 风险打分器与残余风险评估。
- 风险降低措施管理（三步法：固有安全→防护→信息防护）、风险接受准则与审批流。
- 自检检查表与证据管理、变更管理与再评估提醒。

## ISO 13849-1 相关
- 所需 PLr 分析器；架构类别选择与 CCF≥65 评分清单。
- MTTFd/DCavg 数据与计算助手；达成 PL 计算与符合性判断。
- 验证活动清单与记录；诊断测试计划与周期提醒。

## SRS（安全需求规格）模块
1. SRS 模板与结构字段
- 系统边界与运行模式、危险事件与风险目标、所需 PLr、类别（B/1/2/3/4）、DCavg/MTTFd、反应时间/停机时间、失效响应（安全状态）、诊断策略、接口与 I/O 映射、控制需求、软件需求（如适用）、验证与接受准则、CCF 措施、环境/EMC 要求、维护与测试周期。
2. 需求分解与 SRP/CS 分区
- 输入设备/逻辑/输出设备分层（传感器→逻辑→执行器），通道划分与冗余关系描述。
3. 可追溯性与矩阵
- 双向链路矩阵：SRS 需求 ↔ ISO12100 危害 ↔ PLr/计算 ↔ 验证试验 ↔ 证据；支持一键检查缺失/不一致。
4. 变更控制与基线管理
- SRS 版本化、差异对比、审批流与签审记录；变更触发再评估与再验证任务。
5. AI 辅助草拟与一致性检查
- 基于评估数据自动生成 SRS 初稿；检测术语一致性、缺失字段、参数矛盾并给出修正建议。
6. 导出与签审
- 生成 HTML/PDF 的 SRS 文档（含目录、条款索引、签审页、版本信息），支持与正式报告打包归档。
7. 与 PL/验证联动
- SRS 中关键参数驱动 PL 计算器与验证清单；验证完成自动回写满足度。

## 跨域与支撑功能
- 用户认证与权限（安全工程师/审核员/管理员）、审计与可追溯、AI 摘要与整改建议、报告生成与导出、标准知识库与术语索引。

# 技术设计（.NET 8 + React）
## 后端
- 领域模型：`ISO12100Assessment`、`ISO13849Assessment`、`ComplianceChecklist`、`EvaluationResult`、`SrsDocument`、`SrsRequirement`、`Evidence`、`ValidationRecord`。
- 应用服务：`ComplianceEvaluator`、`ISO13849Calculator`、`SrsService`（CRUD/版本化/追溯）、`ReportGenerator`（HTML/PDF）、`AiTextEnhancer`（摘要与建议）。
- API：
  - `/auth/*`（认证与授权）
  - `/compliance/evaluate`、`/compliance/report`
  - `/srs/*`（创建/编辑/版本/审批/导出/追溯矩阵）
  - `/iso13849/*`（PL 计算、MTTFd/DCavg 数据）
  - `/audit/logs`（审计查询）
- 安全：JWT + 策略授权；可选 MFA；密钥走环境变量/机密管理；审计日志不可抵赖。

## 前端（recartUI）
- 页面：登录、ISO12100 风险评估、ISO13849-1 PL 计算、SRS 编辑器（结构化表单+分区视图+矩阵）、验证清单与证据、报告预览与导出、审计日志。
- 组件：危害选择器、S/F/A 打分器、措施管理、CCF 评分表、MTTFd/DCavg 输入助手、SRS 字段卡片、追溯矩阵、审批对话框、任务提醒。

## 数据与存储
- RDBMS（PostgreSQL/SQL Server）：评估记录、SRS 文档与版本、证据元数据、验证记录、审计日志、用户与权限。
- 证据文件存储（对象存储/文件系统）；报告/SRS 版本化归档。

# 设计依据（条款对应）
- ISO 12100：危害识别与风险估计（S/F/A）、风险降低三步法、文档与证据保存。
- ISO 13849-1：
  - SRP/CS 的安全需求应明确化并可验证（SRS 的必要性，含 PLr、类别、诊断、失效响应、反应时间等）；
  - 架构类别（B/1/2/3/4）、DCavg/MTTFd 的选取与计算、CCF 评分阈值（≥65）、验证要求与文档；
  - 验证活动清单与试验（–2 提供详细指南）。
- SRS 与验证的双向追溯：标准要求“需求—实现—验证”的一致性与可追溯（SRS ↔ PL/验证记录）。

# 交互流程（含 SRS）
- 登录→创建评估→ISO12100 危害与 S/F/A 打分→生成措施与再评估→确定 PLr→输入 ISO13849 架构与参数→计算达成 PL→生成/完善 SRS（自动草拟+人工补充）→创建验证计划与执行→记录证据→AI 整理整改建议→导出 SRS 与合规报告→审批与归档。

# 安全与质量保障
- 强认证/授权、审计日志、最小权限；禁止硬编码密钥；SRS 与报告版本化与签审记录。
- 评估计算与 SRS 字段校验的单元/集成测试；接口契约校验与前端表单校验。

# 里程碑
1. M1：危害库、S/F/A 打分器、措施管理、基本报表。
2. M2：PLr 映射、MTTFd/DCavg 管理、CCF 清单、达成 PL 与判断。
3. M2.5：SRS 模块（模板/分区/矩阵/版本化/审批/导出/AI 草拟）。
4. M3：验证清单与证据管理、AI 摘要与整改建议、HTML/PDF 报告。
5. M4：安全与审计完善、提醒与任务；性能与可用性优化。

# 验收标准（示例）
- SRS 文档覆盖必需字段并与危害/PL/验证形成完整追溯；变更有版本与审批；报告含条款索引与证据引用。
- 计算给出明确 PL 达成情况与不符合项；AI 输出的整改建议可执行且无虚构数据。

请确认是否按上述方案纳入 SRS 功能；如需对 SRS 模板字段进行企业化定制（例如增加 SIL 兼容字段、环境试验等级、供应商件号等），我将据此细化实现与数据结构。