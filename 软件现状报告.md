# 安全工具软件现状报告

## 一、项目概述

**项目名称**：机械安全合规自检工具（SafeTool）  
**技术栈**：.NET 9 Minimal API（后端）+ React + TypeScript（前端）  
**架构模式**：前后端分离，基于JWT认证的RESTful API

## 二、已实现功能清单

### 2.1 核心评估功能

#### ISO 12100 风险评估
- ✅ 危害识别（多危害输入）
- ✅ S/F/A 风险打分（严重度/频度/可避性）
- ✅ 风险降低措施管理
- ✅ 所需PLr自动映射（基于规则库）

#### ISO 13849-1 性能等级计算
- ✅ PLr需求分析
- ✅ Category架构选择（B/1/2/3/4）
- ✅ DCavg（平均诊断覆盖率）计算
- ✅ MTTFd（平均危险失效时间）输入与评估
- ✅ CCF（共因失效）评分基础功能
- ✅ 达成PL计算与符合性判断
- ✅ 验证活动标记

#### IEC 62061 功能安全评估
- ✅ SIL目标设定（SIL1/2/3）
- ✅ 子系统架构建模（1oo1/1oo2/2oo3等）
- ✅ 组件PFHd参数输入
- ✅ 子系统PFHd聚合计算（考虑冗余与β因子）
- ✅ 系统级PFHd汇总
- ✅ 达成SIL评估
- ✅ T1/T10D参数管理与基础一致性校核
- ✅ HTML/PDF报告生成

### 2.2 安全需求规格（SRS）模块

- ✅ SRS文档创建（结构化字段）
- ✅ 需求列表管理（标题/描述/接受准则/条款引用）
- ✅ SRS版本化存储
- ✅ 审批流程（单级审批）
- ✅ HTML/PDF导出
- ✅ AI辅助草拟（基于评估数据）
- ✅ 追溯矩阵检查（与ISO12100/ISO13849关联）

### 2.3 数据与库管理

#### 组件安全参数库
- ✅ 组件增删改查（ID/制造商/型号/类别）
- ✅ 安全参数存储（PFHd/DCavg/B10d/MTTFd等，JSON格式）
- ✅ JSON/CSV导入导出
- ✅ 从库中选择组件到评估/模型器

#### 证据库
- ✅ 证据上传（文件/URL）
- ✅ 证据元数据管理（名称/类型/来源/签发机构/有效期）
- ✅ 证据与资源绑定（功能/计算/清单）
- ✅ 证据下载

### 2.4 验证与合规流程

#### 验证清单
- ✅ ISO 13849-2 基础清单（软件开发/CCF评分/DCavg计算）
- ✅ IEC 60204-1 基础清单（接地/急停/导线标识）
- ✅ 清单条目状态管理（pending/pass/fail）
- ✅ 证据关联
- ✅ 责任人/期限分配
- ✅ 推送至合规矩阵

#### 合规矩阵
- ✅ 条款→证据→结果追溯矩阵
- ✅ 矩阵条目增删改查
- ✅ CSV导入导出
- ✅ 与验证清单联动

### 2.5 安全功能建模

#### 模型器
- ✅ I/L/O通道建模（输入/逻辑/输出）
- ✅ 设备选择（从组件库）
- ✅ 通道监测策略配置（none/diagnostics/test）
- ✅ 测试周期/需求率参数
- ✅ Annex K方法选择（simplified/regular）
- ✅ 类别自动推导建议
- ✅ DCavg/PFHd估算计算
- ✅ 项目导入导出（JSON）

### 2.6 报告与输出

- ✅ ISO 12100 + ISO 13849-1 合规报告（HTML/PDF）
- ✅ IEC 62061 评估报告（HTML/PDF）
- ✅ SRS文档导出（HTML/PDF）
- ✅ AI增强摘要与整改建议
- ✅ 报告含计算明细与证据引用

### 2.7 平台功能

#### 认证与授权
- ✅ JWT认证
- ✅ 基础角色控制（user角色）
- ✅ 登录审计

#### 审计与追溯
- ✅ 操作审计日志（用户/操作/资源/详情/时间）
- ✅ 审计日志查询（用户/操作筛选，分页）

#### 互通服务
- ✅ 项目模型JSON导入导出
- ✅ 组件库JSON/CSV导入导出
- ✅ 中间格式转换基础框架

#### 规则配置
- ✅ PLr映射规则管理（S/F/A组合→PLr）
- ✅ 规则持久化存储

## 三、功能缺口分析

### 3.1 标准覆盖缺口

#### ISO 13849-2 验证流程
- ❌ 故障排除清单（系统化故障模式分析）
- ❌ 软件要求验证（软件生命周期与测试记录）
- ❌ 验证计划模板（测试见证与记录）
- ❌ 与SRS任务单联动（自动生成验证任务）

#### IEC 60204-1 电气检查
- ❌ 完整检查表（仅3项基础条目，缺少过载保护/隔离/短路保护等）
- ❌ 整改项闭环跟踪（状态流转/责任人分派/完成确认）
- ❌ 电气图纸关联

### 3.2 建模与计算增强

#### 安全功能建模器
- ❌ 图形化界面（当前为表单式，缺少拖拽画布）
- ❌ 通道连接可视化
- ❌ 实时计算反馈（当前需手动触发）
- ❌ 故障掩蔽风险可视化提示

#### ISO 13849-1 计算增强
- ⚠️ Annex K串联设备DCavg计算（有简化法，常规法需完善）
- ❌ 故障掩蔽上限提示（概率等级与整改建议）
- ❌ 类别选型助手（基于冗余/监测特征自动建议，当前仅基础推导）
- ❌ 串联设备数量限制检查

#### IEC 62061 计算增强
- ⚠️ T1/T10D一致性校核（有基础检查，需增强超期风险提示）
- ❌ 证明试验覆盖率校核
- ❌ 使用寿命超期风险自动提醒
- ❌ SRECS结构化分解与方程简化提示

#### 交叉映射
- ❌ PL↔SIL对照输出（区间映射与注意事项说明）
- ❌ 双标准并行评估合并报告
- ❌ 参数对应关系说明（MTTFd与PFHd）

### 3.3 数据与库管理缺口

#### 组件参数库
- ❌ 版本化与可追溯（当前无版本历史）
- ❌ 供应商数据表与证书附件管理
- ❌ 到期提醒与替代建议
- ❌ 环境与应用限制记录

#### 库互通
- ❌ SISTEMA项目导入（.slib/.spp格式）
- ❌ PAScal数据互通
- ❌ Siemens SET数据互通
- ⚠️ 中间格式映射（有JSON基础，需完善字段映射）

### 3.4 验证与合规流程缺口

#### 变更管理
- ❌ 工程变更单（ECN）
- ❌ 变更影响分析
- ❌ 版本对比（变更前后差异）
- ❌ 双人复核与电子签名
- ❌ 变更触发再评估/再验证任务

#### 证据管理增强
- ⚠️ 到期提醒（有有效期字段，无自动提醒机制）
- ❌ 证据校验（文件完整性/签名验证）
- ❌ 证据链完整性检查

### 3.5 报告与输出缺口

#### 报告模板
- ❌ 可配置报告模板（当前为固定模板）
- ❌ 中英双语切换（当前仅中文）
- ❌ 批量生成（当前为单项目）
- ❌ 项目封面与签审页

#### 合规映射
- ⚠️ 条款映射矩阵（有基础矩阵，需增强标准条款号索引）
- ❌ Requirements→Evidence→Result完整追溯链
- ❌ 缺失/不一致自动检查

### 3.6 平台功能缺口

#### 鉴权与安全
- ❌ 细粒度RBAC（当前仅user角色）
- ❌ 审计事件签名与防篡改
- ❌ 敏感参数脱敏
- ⚠️ 离线/内网部署选项（需配置说明）

#### CLI/批处理
- ❌ 命令行接口
- ❌ 批量评估
- ❌ CI/CD集成

#### 国际化与本地化
- ❌ 中文/英文切换（UI与报告）
- ❌ 单位制本地化
- ❌ 格式本地化（日期/数字）

### 3.7 CCF评分向导

- ⚠️ 基础CCF评分（有评分项列表与计算，缺少问答式向导）
- ❌ Annex F 65分阈值引导
- ❌ 整改建议自动生成
- ❌ 证据条目自动关联

## 四、技术债务

1. **前端UI**：当前为单文件组件，缺少组件化与状态管理（建议引入Zustand/Redux）
2. **数据持久化**：当前使用JSON文件存储，建议迁移至数据库（PostgreSQL/SQL Server）
3. **错误处理**：缺少统一错误处理与用户友好提示
4. **单元测试**：缺少单元测试与集成测试
5. **API文档**：OpenAPI文档未完整生成
6. **性能优化**：组件库万级规模时的查询性能需优化

## 五、总结

### 已完成度评估

- **核心评估功能**：85%（ISO12100/ISO13849-1/IEC62061基础计算完整）
- **SRS模块**：80%（基础功能完整，缺少变更管理）
- **数据管理**：70%（基础CRUD完整，缺少版本化与互通）
- **验证流程**：60%（基础清单存在，缺少完整流程）
- **报告输出**：75%（HTML/PDF生成完整，缺少模板配置与双语）
- **平台功能**：65%（认证/审计基础完整，缺少RBAC与国际化）

### 总体完成度：约72%

---

**报告生成时间**：2025年1月  
**评估基准**：基于功能需求文档与代码审查

